var refererArray=[];chrome.runtime.onMessage.addListener(function(message,sender,sendResponse){if(message.action=="require"){console.log("loading module "+message.file);chrome.tabs.executeScript(sender.tab.id,{file:message.file},function(){console.log("..loaded");sendResponse("ok")})}return true});chrome.runtime.onMessage.addListener(function(message,sender,sendResponse){if(message.action=="xhttp"){var xhttp=new XMLHttpRequest;var method=message.method?message.method.toUpperCase():"GET";if(message.responseType){xhttp.responseType=message.responseType}xhttp.onload=function(){sendResponse(xhttp.responseText)};xhttp.onerror=function(){};xhttp.open(method,message.url,true);if(method=="POST"){xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}xhttp.send(message.data);return true}if(message.action=="referer"){var re=new RegExp("//(.+?)/");var domain=message.url.match(re);console.log(domain);if(domain){console.log("SET http://"+domain[1]+"/*, "+message.referer);if(refererArray[domain[1]]===undefined){refererArray[domain[1]]=message.referer;chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var headers=data.requestHeaders;console.log("REFERER ",message);for(var i=headers.length-1;i>=0;--i){var header=headers[i].name.toLowerCase();if(header=="referer"||header=="cookie"||header=="origin"){if(domain[1]=="www.dailymotion.com"&&header=="cookie"){continue}headers.splice(i,1)}}headers.push({name:"Referer",value:message.referer});console.log(headers);return{requestHeaders:headers}},{urls:["http://"+domain[1]+"/*"]},["requestHeaders","blocking"])}}sendResponse("ok")}if(message.provider=="main"){chrome.tabs.query({active:true,currentWindow:true},function(tabs){chrome.tabs.sendMessage(tabs[0].id,message,function(response){})})}});chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var xdata=data.requestHeaders;xdata.push({name:"Referer",value:""});return{requestHeaders:xdata}},{urls:["http://junkyvideo.com/*"]},["requestHeaders","blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var xdata=data.requestHeaders;xdata.push({name:"Referer",value:"https://openload.co/"});return{requestHeaders:xdata}},{urls:["http://openload.co/embed/*","https://openload.co/embed/*"]},["requestHeaders","blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var xdata=data.requestHeaders;xdata.push({name:"Referer",value:""});return{requestHeaders:xdata}},{urls:["https://*.tunefiles.com/*"]},["requestHeaders","blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var xdata=data.requestHeaders;xdata.push({name:"Referer",value:""});return{requestHeaders:xdata}},{urls:["https://*.escdn.co/*"]},["requestHeaders","blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var xdata=data.requestHeaders;xdata.push({name:"Range",value:"bytes=0-"});return{requestHeaders:xdata}},{urls:["http://flv12.moevideo.net/*"]},["requestHeaders","blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var headers=data.requestHeaders;for(var i=headers.length-1;i>=0;--i){var header=headers[i].name.toLowerCase();if(header=="cookie"&&headers[i].value.indexOf("ff=off")===-1){console.log(headers[i].value);headers[i].value+="; ff=off;"}}return{requestHeaders:headers}},{urls:["https://www.dailymotion.com/*","http://www.dailymotion.com/*"]},["requestHeaders","blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var xdata=data.requestHeaders;for(var i=xdata.length-1;i>=0;--i){var header=xdata[i].name.toLowerCase();if(header!="host"){xdata.splice(i,1)}}xdata.push({name:"Connection",value:"close"});return{requestHeaders:xdata}},{urls:["http://c3.vkcache.com/*","http://c6.vkcache.com/*"]},["requestHeaders","blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var xdata=data.requestHeaders;xdata.push({name:"Referer",value:"https://www.viki.com/"});return{requestHeaders:xdata}},{urls:["https://v.viki.io/*"]},["requestHeaders","blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var xdata=data.requestHeaders;xdata.push({name:"Referer",value:"http://vidzi.tv/"});return{requestHeaders:xdata}},{urls:["https://*.vidzi.tv/*"]},["requestHeaders","blocking"]);chrome.webRequest.onBeforeSendHeaders.addListener(function(data){var xdata=data.requestHeaders;for(var i=xdata.length-1;i>=0;--i){var header=xdata[i].name.toLowerCase();if(header=="referer"){xdata.splice(i,1)}}return{requestHeaders:xdata}},{urls:["https://vidlox.tv/embed-*"]},["requestHeaders","blocking"]);chrome.webRequest.onHeadersReceived.addListener(function(info){var headers=info.responseHeaders;headers.push({name:"Access-Control-Allow-Origin",value:"*"});return{responseHeaders:headers}},{urls:["http://c3.vkcache.com/*","http://c6.vkcache.com/*"]},["blocking","responseHeaders"]);chrome.webRequest.onCompleted.addListener(function(data){console.log(data);return{responseHeaders:data.responseHeaders}},{urls:["http://*.vkcache.com/crossdomain.xml"]},["responseHeaders"]);chrome.webRequest.onBeforeRequest.addListener(function(){return{cancel:true}},{urls:["http://playreplay.net/ann/index.php"]},["blocking"]);
