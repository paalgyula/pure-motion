"use strict";var Provider=function(options){this.APIURL="http://www.thepuremotion.com/api.php";this.url="";this.apiToken="";this.loader="";this.subtitles="";this.playerCode="";this.css="";this.hidenodesonsuccess="";this.randomDomain="";this.RandomAPIURL="";this.File="";this.Key="";this.VideoURL="";this.plugin="";console.log("URL: "+options.url);console.log("TOKEN: "+options.token);this.url=options.url;this.apiToken=options.token;this.loader=options.loader;this.subtitles=options.subtitle;this.width=options.width;this.height=options.height;this.css=options.css;this.hidenodesonsuccess=options.hidenodesonsuccess;return this};Provider.prototype.preProcess=function(url){var that=this;return new Promise(function(resolve,reject){switch(true){case url.indexOf("allvid.ch")>-1:loadHtml(url,function(html){var parser=new DOMParser;var doc=parser.parseFromString(html,"text/html");var url2=doc.querySelector("iframe").getAttribute("src").replace(/\r\n|\r|\n/g,"");chrome.runtime.sendMessage({action:"referer",url:url2,referer:url2},function(data){loadHtml(url2,function(data){resolve({url:url,data:data})})})});break;case url.indexOf("exashare.com")>-1:loadHtml(url,function(html){var parser=new DOMParser;var doc=parser.parseFromString(html,"text/html");var url2=doc.querySelector("iframe").getAttribute("src");chrome.runtime.sendMessage({action:"referer",url:url2,referer:url2},function(data){loadHtml(url2,function(html){resolve({url:url,data:html})})})});break;case url.indexOf("filenuke.com")>-1:httpPost(url,{method_free:"Free"},function(html){resolve({url:url,data:html})});break;case url.indexOf("flashx.pw")>-1||url.indexOf("flashx.tv")>-1||url.indexOf("flash-x.tv")>-1:var re=new RegExp("(flashx.(?:tv|pw))");var domain=url.match(re);var re=new RegExp("c=(\\w+)");var id=url.match(re);loadHtml("https://www."+domain[1]+"/playme-"+id[1]+".html?playvid",function(html){resolve({url:url,data:html})});break;case url.indexOf("grifthost.com")>-1:loadHtml(url,function(html){var parser=new DOMParser;var doc=parser.parseFromString(html,"text/html");httpPost(url,{op:"video_embed3",usr_login:"",id2:doc.querySelector('input[name="id2"]').value,fname:doc.querySelector('input[name="fname"]').value,referer:"",file_code:doc.querySelector('input[name="file_code"]').value,method_free:"Proceed+to+Video"},function(data){resolve({url:url,data:data})})});break;case url.indexOf("indavideo.hu")>-1:var re=new RegExp("/player/video/(.+)");var id=url.match(re);var URL=url;chrome.runtime.sendMessage({action:"referer",url:"http://amfphp.indavideo.hu/SYm0json.php/player.playerHandler.getVideoData/"+id[1],referer:URL},function(data){loadHtml("http://amfphp.indavideo.hu/SYm0json.php/player.playerHandler.getVideoData/"+id[1],function(data){resolve({url:URL,data:data})})});break;case url.indexOf("hqq.tv")>-1:console.log("anyad");loadHtml(url,function(data){$.ajax({type:"POST",url:this.APIURL,data:{url:url,html:data},dataType:"json",success:function(data){url=data.dataUrl;console.log("> "+url);loadHtml(url,function(data){$.ajax({type:"POST",url:this.APIURL,data:{url:url,html:data},dataType:"json",success:function(data){console.log("!!!!! ",data);loadHtml(data.dataUrl,function(data2){console.log("resolve",data.dataUrl,data2);resolve({url:data.dataUrl,data:data2.file})})}})})}})});break;case url.indexOf("playreplay.net")>-1:loadHtml(url,function(html){var re=new RegExp("file=(.+?)&amp;");var uid=html.match(re);var param='[["file/flv_image",{"uid":"'+uid[1]+'"}],["file/flv_link",{"uid":"'+uid[1]+'"}]]';chrome.runtime.sendMessage({action:"referer",url:"http://playreplay.net/data",referer:url},function(data){httpPost("http://playreplay.net/data",{r:param},function(data){httpPost("http://playreplay.net/data",{r:'[["user/check_pin",{"pin":null}]]'},function(){});httpPost("http://playreplay.net/data",{r:'[["directstat/flash_log",{"param":{"index":"mv_errors","data":{"timeFromInit":267320,"Info":"uid=null$ref=playreplay.net$c=mvi$playlist=1","ClienIP":"83.222.49.34","Url":"http://playreplay.net/ann/index.php","Browser":"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36","Id":"","Subtype":"DATA_LOADER","FlashVars":{"file":"58919.57de98a3446f36f1b4536728249d","d":"playreplay.net","_":"5.646","refsite":"playreplay.net"},"Duration":0,"Country":"LU","Count":0,"PlayerType":"Flash","Type":"IO_ERROR","FlashPlayerVersion":"WIN 18,0,0,194","uniqid":"143611175244095966","PlayerVersion":"5.646"}}}]]'},function(){});resolve({url:url,data:data})})})});break;case url.indexOf("powvideo.net")>-1:var iframeURL=url.replace("/embed-","/iframe-");chrome.runtime.sendMessage({action:"referer",url:iframeURL,referer:url},function(data){loadHtml(iframeURL,function(data){resolve({url:url,data:data})})});break;case url.indexOf("raptu.com")>-1:httpPost(url,{block:"1"},function(html){resolve({url:url,data:html})});break;case url.indexOf("shared.sx")>-1:loadHtml(url,function(html){var parser=new DOMParser;var doc=parser.parseFromString(html,"text/html");httpPost(url,{hash:doc.querySelector('input[name="hash"]').value,expires:doc.querySelector('input[name="expires"]').value,timestamp:doc.querySelector('input[name="timestamp"]').value},function(data){resolve({url:url,data:data})})});break;case url.indexOf("streamplay.to")>-1:var re=new RegExp("embed-(\\w+)");var id=url.match(re);loadHtml("http://streamplay.to/player-"+id[1]+"-728x335.html",function(html){resolve({url:url,data:html})});break;case url.indexOf("theplatform.com")>-1:loadHtml(url,function(html){var re=new RegExp('link rel="alternate" href="(.+)" type="application/smil\\+xml"');var smil=html.match(re);if(smil){smil=smil[1]+"&formats=mpeg4&format=SMIL";loadHtml(smil,function(data){resolve({url:url,data:data})})}});break;case url.indexOf("thevideo.me")>-1:loadHtml(url,function(html){var re=new RegExp("var lets_play_a_game='(.+)';");var mpri_Key=html.match(re);loadHtml("https://thevideo.me/vsign/player/"+mpri_Key[1],function(token){loadHtml(url,function(data){resolve({url:url,data:data+token})})})});break;case url.indexOf("tune.pk")>-1:loadHtml(url,function(html){var parser=new DOMParser;var doc=parser.parseFromString(html,"text/html");var url2=doc.querySelector("iframe").getAttribute("src");chrome.runtime.sendMessage({action:"referer",url:url2,referer:url2},function(data){loadHtml(url2,function(html){resolve({url:url,data:html})})})});break;case url.indexOf("userscloud.com")>-1:var re=new RegExp("embed-(\\w+)");var id=url.match(re);if(id){loadHtml("https://userscloud.com/"+id[1],function(html){resolve({url:url,data:html})})}break;case url.indexOf("veoh.com")>-1:var re=new RegExp("permalinkId=([^&]+)");var id=url.match(re);if(!id){var re=new RegExp("http://www.veoh.com/watch/([^/]+)");var id=url.match(re)}loadHtml("http://www.veoh.com/api/findByPermalink?permalink="+id[1],function(data){resolve({url:url,data:data})});break;case url.indexOf("videa.hu")>-1:var re=new RegExp("v=(.+)");var id=url.match(re);if(id){loadHtml("http://videa.hu/flvplayer_get_video_xml.php?v="+id[1]+"&start=0&enablesnapshot=0&r=586474&referrer=",function(data){resolve({url:url,data:data})})}break;case url.indexOf("videakid.hu")>-1:var re=new RegExp("v=(.+)");var id=url.match(re);if(id){loadHtml("http://videakid.hu/flvplayer_get_video_xml.php?v="+id[1]+"&start=0&enablesnapshot=0&r=586474&referrer=",function(data){resolve({url:url,data:data})})}break;case url.indexOf("vidup.me")>-1:loadHtml(url,function(html){var re=new RegExp("var mpri_Key='(.+)';");var mpri_Key=html.match(re);loadHtml("http://vidup.me/jwv/"+mpri_Key[1],function(token){loadHtml(url,function(data){resolve({url:url,data:token+data})})})});break;case url.indexOf("viki.com")>-1:var re=new RegExp("/player/(.+)");var id=url.match(re);chrome.runtime.sendMessage({action:"referer",url:url,referer:url},function(data){loadHtml("http://www.viki.com/player5_fragment/"+id[1]+"."+id[1]+"?autostart=false",function(data){var _APP="65535a";var _APP_SECRET="-$iJ}@p7!G@SyU/je1bEyWg}upLu-6V6-Lg9VD(]siH,r.,m-r|ulZ,U4LC/SeR)";var now=Math.floor(Date.now()/1e3);var query="/v4/videos/"+id[1]+"/streams.json?app="+_APP+"&t="+now+"&site=www.viki.com";var shaObj=new jsSHA("SHA-1","TEXT");shaObj.setHMACKey(_APP_SECRET,"TEXT");shaObj.update(query);var hmac=shaObj.getHMAC("HEX");loadHtml("http://api.viki.io/v4/videos/"+id[1]+"/streams.json?app="+_APP+"&t="+now+"&site=www.viki.com&sig="+hmac,function(json){resolve({url:url,data:"|||"+json+"|||"+data})})})});break;case url.indexOf("waaw.tv")>-1:console.log(url);var prom=new Promise(function(resolve,reject){chrome.runtime.sendMessage({action:"referer",url:url,referer:url},function(data){loadHtml(url,function(data){var re=new RegExp('<iframe src="(.+)" height="100%" width="100%" style="z-index:2147483647;"');var url2=data.match(re);chrome.runtime.sendMessage({action:"referer",url:url2[1],referer:"http://hqq.tv/"},function(data){loadHtml(url2[1],function(data){resolve({url:url2[1],data:data})})})})})});prom.then(function(a){console.log("xx",a);var prom2=that.apiCall(a.url,a.data);prom2.then(function(b){console.log("xx");console.log(b);chrome.runtime.sendMessage({action:"referer",url:b.dataUrl,referer:url},function(data){loadHtml(b.dataUrl,function(html){var prom3=that.apiCall(b.dataUrl,html);prom3.then(function(c){console.log(c);chrome.runtime.sendMessage({action:"referer",url:c.dataUrl,referer:""},function(data){loadHtml(c.dataUrl,function(json){console.log(json);resolve({url:c.dataUrl,data:JSON.stringify(json)})})})})})})})});break;case url.indexOf("youtube.com")>-1:loadHtml(url,function(html){var re=new RegExp("/embed/(.+)");var videoid=url.match(re);var re=new RegExp('"sts":(\\d+)');var match=html.match(re);var getVideoInfoUrl="https://www.youtube.com/get_video_info?html5=1&video_id="+videoid[1]+"&eurl=https%3A%2F%2Fyoutube.googleapis.com%2Fv%2F"+videoid[1]+"&sts="+match[1];loadHtml(getVideoInfoUrl,function(urlparams){resolve({url:url,data:urlparams})})});break;case url.indexOf("youwatch.org")>-1:loadHtml(url,function(html){var parser=new DOMParser;var doc=parser.parseFromString(html,"text/html");var url2=doc.querySelector("iframe").getAttribute("src").replace(/\r\n|\r|\n/g,"");chrome.runtime.sendMessage({action:"referer",url:url2,referer:url2},function(data){loadHtml(url2,function(data){resolve({url:url,data:data})})})});break;default:console.log("no preprocess nedded");loadHtml(url,function(data){resolve({url:url,data:data})});break}})};Provider.prototype.process=function(){console.log("PROCESS",this.url,this.apiToken);var prom=this.preProcess(this.url);var that=this;prom.then(function(url2){var prom=that.apiCall(url2.url,url2.data);prom.then(function(data){if(data.preProcess){that.url=data.videoUrl;that.process();return true}chrome.runtime.sendMessage({action:"referer",url:data.videoUrl,referer:that.url},function(){that.player(data.videoUrl,data.rtmpUrl||"",data.subtitleUrl?data.subtitleUrl:(data.subtitles?data.subtitles:[])||"",that.width,that.height,data.VideoEmbedType)})})})};Provider.prototype.apiCall=function(url,data){var data=data||"";var that=this;console.log("APICALL",url);return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open("POST",that.APIURL);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onload=function(){var data=JSON.parse(xhr.responseText);if(typeof data.status==="string"&&data.status=="ok"){resolve(data)}else{}};var post="token="+encodeURIComponent(that.apiToken)+"&url="+encodeURIComponent(url)+"&html="+encodeURIComponent(data);if(chrome.extension.getURL("img").indexOf("moz-extension://")>-1){post+="&d="+encodeURIComponent(window.location.hostname)}xhr.send(post)})};Provider.prototype.player=function(file,rtmp,subtitle,width,height,type){var rtmp=rtmp||"";var subtitle=subtitle||"";var width=width||728;var height=height||335;var type=type||(file.indexOf(".flv")>-1||file.indexOf("rtmp")>-1?"flash":"html5");var playerUrl="http://www.thepuremotion.com/player/player.swf";var shortcutsUrl="http://www.thepuremotion.com/player/shortcuts.swf";var subtitles=isJsonString(this.subtitles)?JSON.parse(this.subtitles):this.subtitles?[this.subtitles]:[];if(typeof subtitle==="string"){subtitles.push({lang:"",label:"attached",url:subtitle})}else if(Array.isArray(subtitle)){for(i in subtitle){subtitles.push({lang:"",label:subtitle[i].label,url:subtitle[i].url})}}console.log(subtitles);var that=this;if(type=="html5"){var prom=new Promise(function(resolve,reject){var subtitleTags="";var subtitleCnt=subtitles.length;var processed=0;if(subtitles.length===0){resolve()}for(s in subtitles){var blobUrl="";(function(s){if(subtitles[s]["url"].charAt(0)=="/"){subtitles[s]["url"]=window.location.protocol+"//"+window.location.host+subtitles[s]["url"]}var xhr=new XMLHttpRequest;xhr.open("GET",subtitles[s]["url"]);xhr.responseType="arraybuffer";xhr.onload=function(){var data=new Uint8Array(xhr.response);var detected=Encoding.detect(data);console.log(detected);var dataView=new DataView(xhr.response);var decoder=new TextDecoder(detected=="UTF8"?"utf-8":detected=="UTF16"?"utf-16":"iso-8859-2");var data=decoder.decode(dataView);if(subtitles[s]["url"].indexOf(".srt")>-1){var re=new RegExp("([0-9]{2}:[0-9]{2}:[0-9]{2}),([0-9]{3})","g");data="WEBVTT FILE\n\n"+data.replace(re,"$1.$2")}else if(data.indexOf("WEBVTT FILE")===-1){data="WEBVTT FILE\n\n"+data}var blob=new Blob([data],{type:"text/vtt"});blobUrl=URL.createObjectURL(blob);subtitleTags+='<track label="'+subtitles[s]["label"]+'" kind="subtitles" srclang="'+subtitles[s]["lang"]+'" src="'+blobUrl+'"'+(processed===0?" default":"")+">";if(++processed==subtitleCnt){resolve(subtitleTags)}};xhr.send()})(s)}});prom.then(function(subtitleTags){if(that.plugin=="plyr"){loadHtml(chrome.extension.getURL("templates/plyrvideo.html"),function(data){var template=Handlebars.compile(data);var context={file:file,subtitleTags:subtitleTags,width:width,height:height,css:that.css,imagepath:chrome.extension.getURL("img"),plyr:chrome.extension.getURL("plyr")};var playerCode=template(context);document.querySelector("puremotion").insertAdjacentHTML("afterend",playerCode);runPlyr();if(that.hidenodesonsuccess&&document.querySelector(that.hidenodesonsuccess)){document.querySelector(that.hidenodesonsuccess).style.display="none"}if(that.loader){var node=document.querySelector(that.loader);if(node){node.parentNode.removeChild(node)}}})}else if(file.indexOf(".m3u8")>-1){loadHtml(chrome.extension.getURL("templates/hlsvideo.html"),function(data){var template=Handlebars.compile(data);var context={file:file,subtitleTags:subtitleTags,width:width,height:height,css:that.css,imagepath:chrome.extension.getURL("img"),videojspath:chrome.extension.getURL("videojs")};var playerCode=template(context);document.querySelector("puremotion").insertAdjacentHTML("afterend",playerCode);chrome.runtime.sendMessage({action:"require",file:"videojs/video.js"},function(data){chrome.runtime.sendMessage({action:"require",file:"videojs/videojs-contrib-hls.min.js"},function(data){var player=videojs("example-video");player.play()})});if(that.hidenodesonsuccess&&document.querySelector(that.hidenodesonsuccess)){document.querySelector(that.hidenodesonsuccess).style.display="none"}if(that.loader){var node=document.querySelectorAll(that.loader);if(node){for(var i=0;i<node.length;i++){node[i].parentNode.removeChild(node[i])}}}})}else{loadHtml(chrome.extension.getURL("templates/html5video.html"),function(data){var template=Handlebars.compile(data);var context={file:file,subtitleTags:subtitleTags,width:width,height:height,css:that.css,imagepath:chrome.extension.getURL("img")};var playerCode=template(context);document.querySelector("puremotion").insertAdjacentHTML("afterend",playerCode);runHtml5VideoHelper();if(that.hidenodesonsuccess&&document.querySelector(that.hidenodesonsuccess)){document.querySelector(that.hidenodesonsuccess).style.display="none"}if(that.loader){var node=document.querySelectorAll(that.loader);if(node){for(var i=0;i<node.length;i++){node[i].parentNode.removeChild(node[i])}}}})}})}else{if(file.indexOf(".mpd")>-1){var s=document.createElement("script");s.src="http://p.jwpcdn.com/6/8/jwplayer.js";(document.head||document.documentElement).appendChild(s);var s=document.createElement("script");s.src="http://files.streamroot.io/release/1.1/api.js";(document.head||document.documentElement).appendChild(s);var s=document.createElement("script");s.src="http://files.streamroot.io/release/1.1/wrappers/jwplayer/6.8/streamroot.wrapper.min.js";(document.head||document.documentElement).appendChild(s);var actualCode=["setTimeout(function () {",'jwplayer("myElement").setup({','file: "'+file+'",','type: "video/dash",','primary: "srflash",','srflashplayer : "http://files.streamroot.io/release/1.1/wrappers/jwplayer/6.8/jwplayer.srflash.swf",',"sr_options: {",'ID_CLIENT : "ry-srewok",',"},",'startparam: "start",','duration: "800",','width: "'+width+'",','height: "'+height+'",','title: "Click You watch ",','aspectratio: "16:9",','stretching: "uniform",',"});","}, 500);"].join("\n");var script=document.createElement("script");script.textContent=actualCode;(document.head||document.documentElement).appendChild(script);Loading.show();if(that.hidenodesonsuccess&&document.querySelector(that.hidenodesonsuccess)){document.querySelector(that.hidenodesonsuccess).style.display="none"}if(that.loader){var node=document.querySelectorAll(that.loader);if(node){for(var i=0;i<node.length;i++){node[i].parentNode.removeChild(node[i])}}}}else{var flashvars="";flashvars="file="+encodeURIComponent(file)+(rtmp?"&amp;streamer="+encodeURIComponent(rtmp):"&amp;provider=http");flashvars+="&amp;plugins="+shortcutsUrl+(subtitles?",captions":"")+"&amp;controlbar.idlehide=true&amp;shortcuts.step=10";var files=[];var labels=[];for(s in subtitles){files[s]=subtitles[s]["url"].replace(",","%2C");labels[s]=encodeURIComponent(subtitles[s]["label"].replace(",",".")+" ("+subtitles[s]["lang"]+")")}flashvars+="&amp;captions.files="+files.join(",");flashvars+="&amp;captions.labels="+labels.join(",");flashvars+="&amp;captions.state=true";loadHtml(chrome.extension.getURL("templates/flashvideo.html"),function(data){var template=Handlebars.compile(data);var context={playerUrl:playerUrl,flashvars:flashvars,width:width,height:height};var playerCode=template(context);document.querySelector("puremotion").insertAdjacentHTML("afterend",playerCode);if(that.hidenodesonsuccess&&document.querySelector(that.hidenodesonsuccess)){document.querySelector(that.hidenodesonsuccess).style.display="none"}if(that.loader){var node=document.querySelectorAll(that.loader);if(node){for(var i=0;i<node.length;i++){node[i].parentNode.removeChild(node[i])}}}})}}};function loadHtml(url,callback,headers,responseType){var xhttp=new XMLHttpRequest;xhttp.onload=function(){callback(xhttp.responseText)};xhttp.onerror=function(){};xhttp.open("GET",url,true);if(headers){for(var i in headers){xhttp.setRequestHeader(i,headers[i])}}xhttp.send()}function httpPost(url,params,callback,headers){var xhttp=new XMLHttpRequest;xhttp.onload=function(){callback(xhttp.responseText)};xhttp.onerror=function(){};xhttp.open("POST",url,true);xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(headers){for(var i in headers){xhttp.setRequestHeader(i,headers[i])}}var seg="";if(params){for(var p in params){seg+=(seg?"&":"")+p+"="+encodeURIComponent(params[p])}}xhttp.send(seg)}function isJsonString(str){try{JSON.parse(str)}catch(e){return false}return true}function checkVideo(VideoURL,siteURL){return new Promise(function(resolve,reject){chrome.runtime.sendMessage({action:"referer",url:VideoURL,referer:siteURL},function(){var xhr=new XMLHttpRequest;xhr.open("GET",VideoURL,true);xhr.setRequestHeader("Cache-Control","no-cache");xhr.setRequestHeader("Range","bytes=0-100");xhr.responseType="arraybuffer";xhr.onprogress=function(event){};xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status!==200&&xhr.status!==206){console.log("Error",xhr.statusText);reject("video not found")}else{resolve("video ok")}}};xhr.send()})})}var videoPlayer={puremotionPlayer:null,videoControls:null,playBtn:null,isVideoFullScreen:false,width:null,height:null,init:function(){var that=this;this.puremotionPlayer=document.querySelector("#video_tag");this.width=document.querySelector(".puremotion_container").offsetWidth;this.height=document.querySelector(".puremotion_container").offsetHeight;this.videoControls=document.getElementById("puremotion_controls");this.playBtn=document.getElementById("play-pause");this.puremotionPlayer.addEventListener("loadeddata",this.initializeControls,false);this.handleButtonPresses();document.querySelector("#fullscreen").addEventListener("click",function(){that.isVideoFullScreen?that.fullScreenOff():that.fullScreenOn()},true);document.addEventListener("webkitfullscreenchange",function(){if(document.webkitIsFullScreen===false){that.fullScreenOff()}},false);this.puremotionPlayer.addEventListener("timeupdate",this.updatePlayProgress,false);this.videoScrubbing();this.keyPress()},initializeControls:function(){videoPlayer.showHideControls()},showHideControls:function(){return;this.puremotionPlayer.addEventListener("mouseover",function(){videoPlayer.videoControls.style.opacity=1},false);this.videoControls.addEventListener("mouseover",function(){videoPlayer.videoControls.style.opacity=1},false);this.puremotionPlayer.addEventListener("mouseout",function(){videoPlayer.videoControls.style.opacity=0},false);this.videoControls.addEventListener("mouseout",function(){videoPlayer.videoControls.style.opacity=0},false)},handleButtonPresses:function(){document.querySelector("#play-pause").addEventListener("click",this.playPause,false);this.puremotionPlayer.addEventListener("ended",function(){console.log("vege");this.currentTime=0;this.pause()},false)},playPause:function(){videoPlayer.puremotionPlayer.playbackRate=1;if(videoPlayer.puremotionPlayer.paused||videoPlayer.puremotionPlayer.ended||!$(".puremotion_overlay").hasClass("paused")){$(".puremotion_overlay").addClass("paused");videoPlayer.puremotionPlayer.play();videoPlayer.playBtn.innerHTML="pause"}else{$(".puremotion_overlay").removeClass("paused");videoPlayer.puremotionPlayer.pause();videoPlayer.playBtn.innerHTML="play"}},updatePlayProgress:function(){var progressBar=document.querySelector("#puremotion_controls progress");var percentage=Math.floor(100/videoPlayer.puremotionPlayer.duration*videoPlayer.puremotionPlayer.currentTime);progressBar.value=percentage;progressBar.innerHTML=percentage+"% played"},videoScrubbing:function(){document.querySelector("#puremotion_controls progress").addEventListener("click",function(e){var percent=e.offsetX/this.offsetWidth;videoPlayer.seekToPercent(percent);document.querySelector("#puremotion_controls progress").value=percent*100},true)},seekToPercent:function(percent){this.puremotionPlayer.currentTime=percent*this.puremotionPlayer.duration},seekToTime:function(value){var seekToTime=this.puremotionPlayer.currentTime+value;if(seekToTime<0||seekToTime>this.puremotionPlayer.duration){return}this.puremotionPlayer.currentTime=seekToTime},setVol:function(value){var vol=this.puremotionPlayer.volume;vol+=value;if(vol>=0&&vol<=1){this.puremotionPlayer.volume=vol}else{this.puremotionPlayer.volume=vol<0?0:1}},fullScreenOn:function(){videoPlayer.isVideoFullScreen=true;document.querySelector(".puremotion_container").webkitRequestFullscreen();document.querySelector(".puremotion_container").style.width="100%";document.querySelector(".puremotion_container").style.height="100%"},fullScreenOff:function(){videoPlayer.isVideoFullScreen=false;document.webkitExitFullscreen();document.querySelector(".puremotion_container").style.width=videoPlayer.width+"px";document.querySelector(".puremotion_container").style.height=videoPlayer.height+"px"},keyPress:function(){$(document).keydown(function(e){if(e.target.nodeName=="TEXTAREA"||e.target.nodeName=="INPUT"){return}switch(e.which){case 37:videoPlayer.seekToTime(-5);break;case 39:videoPlayer.seekToTime(5);break;case 38:videoPlayer.setVol(.1);break;case 40:videoPlayer.setVol(-.1);break;default:return}e.preventDefault()})}};function runPlyr(){chrome.runtime.sendMessage({action:"require",file:"plyr/dist/plyr.js"},function(data){});setTimeout(function(){plyr.setup({debug:true});loadHtml(chrome.extension.getURL("plyr/dist/sprite.svg"),function(a){var c=document.createElement("div");c.setAttribute("hidden","");c.innerHTML=a;document.body.insertBefore(c,document.body.childNodes[0])})},1e3)}function runHtml5VideoHelper(){document.getElementById("source_vid").addEventListener("error",function failed(e){var vid=document.getElementById("video_tag");if(vid.networkState==vid.NETWORK_NO_SOURCE){console.log("BAJ VAN")}},true);$("#video_tag").on("loadstart",function(event){$(this).addClass("loading")});$("#video_tag").on("canplay",function(event){$(this).removeClass("loading");$(".puremotion_overlay").addClass("play");console.log("canplay")});$("#video_tag").on("waiting",function(event){$(this).addClass("loading");console.log("waiting")});$("#video_tag").on("waiting",function(event){$(this).addClass("loading");console.log("waiting")});$("#video_tag").on("play",function(event){$(".puremotion_overlay").removeClass("play");console.log("PLAY")});$("#video_tag").on("playing",function(event){$(".puremotion_overlay").removeClass("play");console.log("PLAYING")});$("#video_tag").on("pause",function(event){$(".puremotion_overlay").addClass("play")});var video=$("#video_tag");$("#video_tag").on("click",function(){playpause()});$(".puremotion_overlay").on("click",function(){playpause()});video.find("track").each(function(index,value){console.log(index,value,$(this).attr("label"),$(this).attr("srclang"));$(".puremotion_overlay_subtitles").append('<li><a href="#" class="sub" onclick="return false;">'+$(this).attr("label")+"</a></li>")});$(".sub").click(function(){$(".sub").css("font-weight","normal");var label=$(this).html();$(video.prop("textTracks")).prop("mode",function(){return this.label==label?"showing":"disabled"});$(this).css("font-weight","bold")});$("#video_tag, .puremotion_overlay, .puremotion_overlay_subtitles").on("mouseover",function(){if(video.find("track").length>0){$(".puremotion_overlay_subtitles").show()}});$("#video_tag, .puremotion_overlay, .puremotion_overlay_subtitles").on("mouseout",function(){$(".puremotion_overlay_subtitles").hide()});var playpause=function(){video[0].playbackRate=1;if(video[0].paused||video[0].ended||!$(".puremotion_overlay").hasClass("paused")){$(".puremotion_overlay").addClass("paused");video[0].play()}else{$(".puremotion_overlay").removeClass("paused");video[0].pause()}};$(window).keypress(function(e){if(e.target.nodeName=="TEXTAREA"||e.target.nodeName=="INPUT"){return}if(e.keyCode==0||e.keyCode==32){playpause();e.preventDefault()}});$(window).keydown(function(e){if(e.target.nodeName=="TEXTAREA"||e.target.nodeName=="INPUT"){return}switch(e.which){case 37:seekToTime(-5);break;case 39:seekToTime(5);break;case 38:setVol(.1);break;case 40:setVol(-.1);break;default:return}e.preventDefault()});function setVol(value){var vol=video[0].volume;vol+=value;if(vol>=0&&vol<=1){video[0].volume=vol}else{video[0].volume=vol<0?0:1}video[0].setAttribute("controls","controls")}function seekToTime(value){var seekToTime=video[0].currentTime+value;if(seekToTime<0||seekToTime>video[0].duration){return}video[0].currentTime=seekToTime}}var Captcha={selector:"#puremotion_captcha",captchaUrl:"",show:function(captchaUrl,callback){this.captchaUrl=captchaUrl;var that=this;loadHtml(chrome.extension.getURL("templates/captcha.html"),function(data){var template=Handlebars.compile(data);var context={captchaUrl:captchaUrl};var captcha=template(context);document.querySelector("puremotion").insertAdjacentHTML("afterend",captcha);document.querySelector(that.selector+" input[name=sendcaptcha]").addEventListener("click",function(e){callback(document.querySelector(that.selector+" input[name=captcha]").value)},false);document.querySelector(that.selector+" input[name=reload]").addEventListener("click",function(e){that.reload()},false)})},remove:function(){var node=document.querySelector(this.selector);node.parentNode.removeChild(node)},reload:function(){document.querySelector(this.selector+" img").src=this.captchaUrl+"?"+(new Date).getTime();this.badCaptcha("off")},badCaptcha:function(status){if(status=="on"){document.querySelector(this.selector+" .status").style.display=""}else{document.querySelector(this.selector+" .status").style.display="none"}}};var Loading={selector:"#puremotion_loading",show:function(){document.querySelector("puremotion").insertAdjacentHTML("afterend",'<div id="puremotion_loading" style="background: transparent url(\''+chrome.extension.getURL("img")+"/ajax-loader.gif') center center no-repeat;\">&nbsp;</div>")},remove:function(){var node=document.querySelector(this.selector);node.parentNode.removeChild(node)}};
